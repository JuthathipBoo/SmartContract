"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{4879:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var s=a(5155),n=a(2115),l=a(5219),r=a(1681),i=a(2741),d=a(8112),c=a(2044);a(5685);var o=a(9911);let y="0xcad5f9e46c354e2c46994d8958d3dc445dad86ef",m=[{inputs:[{internalType:"address",name:"employee",type:"address"},{internalType:"uint256",name:"salary",type:"uint256"}],name:"addEmployeeAndPayFirst",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"fundPayroll",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"employee",type:"address"}],name:"paySalary",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_payrollPeriod",type:"uint256"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"employee",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Paid",type:"event"},{inputs:[],name:"contractBalance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"employeeList",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getEmployees",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastPaid",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"payrollPeriod",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"salaries",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}];function u(){let[e,t]=(0,n.useState)([]),[a,u]=(0,n.useState)({address:"",salary:""}),[p,h]=(0,n.useState)(0),[x,f]=(0,n.useState)("");(0,n.useEffect)(()=>{let e=localStorage.getItem("employees");e&&t(JSON.parse(e))},[]),(0,n.useEffect)(()=>{localStorage.setItem("employees",JSON.stringify(e))},[e]);let g=async()=>{let e=new l.k(window.ethereum),t=await e.getSigner();return new r.NZ(y,m,t)};async function w(e,t){let a=await g();try{let s=await a.addEmployeeAndPayFirst(e,i.g5(t.toString()));await s.wait(),console.log("Employee added and first salary paid")}catch(e){console.error("Error adding employee:",e)}}let N=async()=>{if(console.log("newEmployee.address =",a.address),console.log("newEmployee.salary =",a.salary),""!==a.address.trim()&&!isNaN(parseFloat(a.salary))&&parseFloat(a.salary)>0){let s=parseFloat(a.salary);if(p<s)return void alert("ยอดเงินในระบบไม่เพียงพอในการจ่ายเงินเดือน!");if(e.some(e=>e.address.toLowerCase()===a.address.toLowerCase()))return void alert("พนักงานคนนี้มีอยู่แล้วในระบบ");try{await w(a.address,a.salary),h(e=>{let t=e-s;return localStorage.setItem("fundedAmount",JSON.stringify(t)),t});let e={address:a.address,salary:s,canPay:!1,dateAdded:new Date().toISOString()};t(t=>{let a=[...t,e];return localStorage.setItem("employees",JSON.stringify(a)),a}),u({address:"",salary:""})}catch(e){console.error("เกิดข้อผิดพลาด:",e),alert(e.reason||"เกิดข้อผิดพลาดในการเพิ่มพนักงาน")}}else alert("กรุณากรอกข้อมูลให้ครบถ้วน")},b=async(e,a)=>{let s=await g(),n=await s.paySalary(e);await n.wait(),alert("จ่ายเงินเดือนสำเร็จ!"),h(e=>{let t=e-a;return localStorage.setItem("fundedAmount",JSON.stringify(t)),t}),t(t=>t.map(t=>t.address===e?{...t,canPay:!1}:t))},j=async e=>{if(!e||isNaN(Number(e))||0>=Number(e))return void alert("กรุณากรอกจำนวนเงินที่ต้องการเติมให้ถูกต้อง");try{let t=await g(),a=await t.fundPayroll({value:i.g5(e)});await a.wait(),alert("เติมเงินเข้าสู่ระบบสำเร็จ!"),h(t=>{let a=t+Number(e);return localStorage.setItem("fundedAmount",JSON.stringify(a)),a})}catch(e){console.error("Error funding payroll:",e),alert("เกิดข้อผิดพลาดในการเติมเงิน!")}};(0,n.useEffect)(()=>{let e=localStorage.getItem("fundedAmount");e&&h(Number(e))},[]);let v=e=>new Date(e).toLocaleDateString("th-TH",{day:"2-digit",month:"short",year:"numeric"}),S=e=>{confirm("คุณแน่ใจหรือไม่ว่าต้องการลบพนักงานนี้?")&&t(t=>{let a=t.filter(t=>t.address!==e);return localStorage.setItem("employees",JSON.stringify(a)),a})},T=async()=>{let e=await window.ethereum.request({method:"eth_requestAccounts"});f(e[0]),localStorage.setItem("connectedWallet",e[0]),await A(),await P()},E=async()=>{let e=new l.k(window.ethereum),t=await e.getSigner();return new r.NZ(y,m,t)},A=async()=>{try{let e=await E(),a=(await e.getEmployees()).filter(e=>null!==e.salary&&void 0!==e.salary).map(e=>({wallet:e.wallet,salary:Number(i.ck(e.salary)),lastPaidDay:Number(e.lastPaidDay)}));t(a),console.log("Fetched employees:",a)}catch(e){console.error("Error fetching employees:",e)}},P=async()=>{try{let e=await E(),t=await e.contractBalance(),a=Number(i.ck(t));h(a),console.log("Fetched funded amount:",a)}catch(e){console.error("Error fetching funded amount:",e)}};return(0,s.jsxs)("div",{className:"min-h-screen bg-light",children:[(0,s.jsxs)("header",{className:"bg-primary text-white p-4 flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-xl font-bold",children:"ระบบจ่ายเงินเดือน (Payroll System)"}),(0,s.jsxs)(c.P.div,{initial:{scale:0},animate:{scale:1},className:"flex items-center gap-2",children:[x?(0,s.jsxs)("div",{className:"bg-white text-primary font-mono px-3 py-2 rounded-xl shadow-sm text-sm",children:["Connected: ",x.slice(0,6),"...",x.slice(-4)]}):(0,s.jsxs)(d.A,{variant:"light",className:"d-flex align-items-center gap-2 fw-bold",onClick:T,style:{borderRadius:"999px"},children:[(0,s.jsx)(o.lcY,{}),"Connect Wallet"]}),x&&(0,s.jsx)("button",{onClick:()=>{t([]),h(0),f(""),localStorage.removeItem("connectedWallet"),console.log("Disconnected wallet!")},className:"btn btn-danger",children:"Disconnect Wallet"})]})]}),(0,s.jsxs)(c.P.div,{initial:{opacity:0},animate:{opacity:1},children:[(0,s.jsxs)("div",{className:"card p-4 m-4 mx-auto",style:{maxWidth:"600px"},children:[(0,s.jsx)("h2",{className:"card-title",children:"เพิ่มพนักงานใหม่"}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("input",{type:"text",placeholder:"Address ของพนักงาน",value:a.address,onChange:e=>u({...a,address:e.target.value}),className:"form-control mb-2"}),(0,s.jsx)("input",{type:"number",placeholder:"จำนวนเงินเดือน (ETH)",value:a.salary,onChange:e=>u({...a,salary:e.target.value}),className:"form-control mb-2"}),(0,s.jsx)(d.A,{className:"btn btn-success w-100",onClick:N,children:"เพิ่มพนักงาน"})]})]}),(0,s.jsxs)("div",{className:"card p-4 m-4 mx-auto",style:{maxWidth:"1000px"},children:[(0,s.jsx)("h2",{className:"card-title",children:"รายการพนักงาน"}),(0,s.jsxs)("table",{className:"table table-bordered text-sm",children:[(0,s.jsx)("thead",{className:"table-light",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-2 text-left",children:"Address"}),(0,s.jsx)("th",{className:"p-2 text-left",children:"เงินเดือน"}),(0,s.jsx)("th",{className:"p-2 text-left",children:"สถานะ"}),(0,s.jsx)("th",{className:"p-2",children:"Action"})]})}),(0,s.jsx)("tbody",{children:e.map((e,t)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"p-2 font-mono",children:e.address}),(0,s.jsxs)("td",{className:"p-2",children:[e.salary.toLocaleString()," ETH"]}),(0,s.jsx)("td",{className:"p-2",children:v(e.dateAdded)}),(0,s.jsx)("td",{className:"p-2",children:e.canPay?"พร้อมจ่าย":"ยังไม่ถึงรอบ"}),(0,s.jsxs)("td",{className:"p-2 text-center",children:[(0,s.jsx)(d.A,{className:"btn btn-primary",onClick:()=>b(e.address,e.salary),disabled:!e.canPay,children:"จ่ายเงินเดือน"}),(0,s.jsx)(d.A,{className:"btn btn-danger",onClick:()=>S(e.address),children:"ลบ"})]})]},t))})]})]}),(0,s.jsxs)("div",{className:"card p-4 m-4 text-center mx-auto",style:{maxWidth:"500px"},children:[(0,s.jsx)("h2",{className:"card-title",children:"เติมเงินเข้าสู่ระบบ"}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("input",{type:"number",placeholder:"จำนวนเงินที่ต้องการเติม (ETH)",className:"form-control mb-2",value:a.salary,onChange:e=>u({...a,salary:e.target.value})}),(0,s.jsx)(d.A,{className:"btn btn-primary w-100",onClick:()=>j(a.salary),children:"เติมเงิน"})]})]}),(0,s.jsxs)("div",{className:"card p-4 m-4 text-center mx-auto",style:{maxWidth:"500px"},children:[(0,s.jsx)("p",{className:"text-lg",children:"ยอดเงินที่เติมเข้ามา:"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-success",children:[p," ETH"]})]})]})]})}}}]);